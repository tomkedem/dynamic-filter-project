<form [formGroup]="form" (ngSubmit)="onSubmit()" class="dynamic-form">
  
  <!-- Report Type Selection and Button -->

  <div class="report-type-group">
    <label>סוג דוח:</label>
    <select formControlName="reportType" >
      <option [value]="reportTypes.Orders">דוח הזמנות</option>
      <option [value]="reportTypes.TransportationData">דוח נתוני הסעות</option>
      <option [value]="reportTypes.DummyReport">דוח דמה</option>
      <option [value]="reportTypes.TestReport">דוח בדיקה</option>
    </select>
    <button nz-button class="btn btn-orange report-btn">הפקת דוח</button>
  </div>
  <nz-switch [(ngModel)]="checked" (ngModelChange)="handleChange($event)"></nz-switch>
 
<!-- Toggle Switch for Filters -->
<div class="toggle-filters-group">
  
    <ng-template #checkedTemplate><span nz-icon nzType="check"></span></ng-template>
    <ng-template #unCheckedTemplate><span nz-icon nzType="close"></span></ng-template>
 
  <label class="switch">
    <input type="checkbox" id="toggle-filters1" (change)="toggleFilters()" />
    <span class="slider round"></span>
  </label>
  <label for="toggle-filters" class="filter-label">הצגה/הסתרת מסננים</label>
</div>

@if(controlsVisible){
  <!-- Dynamic Controls -->
  @for (control of controls; track control) {

    <div class="form-control-group" >
      <label>{{ control.label }}</label>
      <ng-container [ngSwitch]="control.type">

      <!-- Dropdown -->
      @if (control.type === 'dropdown'){
        <select [formControlName]="control.controlName" class="form-control">
          @for (option of control.options; track option) {
              <option [value]="option.id">{{ option.name }}</option>
          }
        </select>
        @if (form.get(control.controlName)?.invalid && form.get(control.controlName)?.touched){
          <div class="text-danger">
              @if(form.get(control.controlName)?.errors?.['required']){
                  שדה חובה
              }  
          </div>
        }
      }

      <!-- MultiSelect Dropdown -->
      @if (control.type === 'multiselect'){
        <select multiple [formControlName]="control.controlName" class="form-control">
          @for (option of control.options; track option) {
            <option [value]="option.id">{{ option.name }}</option>
          }
        </select>
        @if (form.get(control.controlName)?.invalid && form.get(control.controlName)?.touched){
          <div class="text-danger">
              @if(form.get(control.controlName)?.errors?.['required']){
                שדה חובה
              }              
          </div>
          }
      }

      <!-- Datepicker -->
      @if (control.type === 'datepicker'){
        <input type="date" [formControlName]="control.controlName" class="form-control" />
        @if (form.get(control.controlName)?.invalid && form.get(control.controlName)?.touched){
          <div class="text-danger">
              @if(form.get(control.controlName)?.errors?.['required']){
                  שדה חובה
              }  
          </div>
          }
      }
      
      <!-- Input Field -->
      @if (control.type === 'input'){
        <input type="text" [formControlName]="control.controlName" class="form-control" />
        @if (form.get(control.controlName)?.invalid && form.get(control.controlName)?.touched){
          <div class="text-danger">
              @if(form.get(control.controlName)?.errors?.['required']){
                  שדה חובה
              }  
              @if(form.get(control.controlName)?.errors?.['min']){
              // הערך צריך להיות גדול מ-{{ form.get(control.controlName)?.errors?.['min']?.min }}
              }
          </div>
          }
      }

      <!-- Autocomplete -->
      @if (control.type === 'autocomplete'){
        <input type="text" [formControlName]="control.controlName" class="form-control" [attr.list]="'autocomplete_' + control.controlName" />
        <datalist [id]="'autocomplete_' + control.controlName">
          @for (option of control.options; track option) {            
            <option [value]="option.name"></option>
          }
        </datalist>
        @if (form.get(control.controlName)?.invalid && form.get(control.controlName)?.touched){
          <div class="text-danger">
            <div *ngIf="form.get(control.controlName)?.errors?.['required']">
              שדה חובה
            </div>
          </div>
        }
      }

    </ng-container>
   </div>
  }
}
</form>